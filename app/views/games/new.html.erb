<canvas id="myCanvas" width="500" height="600"></canvas>

<script>
  var canvas = document.getElementById("myCanvas");
  var ctx = canvas.getContext("2d");
  var score = 0;
  var dy = 1;
  var words = [];
  var active_words = [];
  var lives = 5;

  function getWords() {
    return $.ajax({
      url: "/game-words",
      method: "get"
    }).done(function(response) {
      for (var i in response) {
        words.push(response[i])
      }
    })
  }

  function collisionTest() {
    for (var i in active_words) {
      if (active_words[i].y > canvas.height - 10) {
        active_words.splice(i, 1)
        lives -= 1;
      }
    }
  }

  function addWord() {
    if (words.length > 0) {
      var word = words.shift()
      active_words.push(word);
    }
  }

  function drawLives() {
    ctx.font = "16px Arial";
    ctx.fillStyle = "#0095DD";
    ctx.fillText("Lives: " + lives, 5, 595);
  }

  function drawWord() {
    ctx.font = "16px Arial";
    ctx.fillStyle = "#0095DD";
    for (var i in active_words) {
      ctx.fillText(active_words[i].text, active_words[i].x, active_words[i].y);
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawLives();
    drawWord();
    for (var i in active_words) {
      active_words[i].y += dy;
    }
    collisionTest();

    if (lives === 0) {
      console.log("over");
      alert("GAME OVER");
      document.location.reload();
    }

    requestAnimationFrame(draw);
  }

  $.when(getWords()).done(function() {
    setInterval(addWord, 2000);
    draw();
  })
</script>
